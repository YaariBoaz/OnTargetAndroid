{"version":3,"file":"ngx-capture.js","sources":["../../../projects/ngx-capture/src/lib/ngx-capture.service.ts","../../../projects/ngx-capture/src/lib/ngx-capture.component.ts","../../../projects/ngx-capture/src/lib/ngx-capture.module.ts","../../../projects/ngx-capture/src/public-api.ts","../../../projects/ngx-capture/src/ngx-capture.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport html2canvas from 'html2canvas';\r\nimport { from, Observable, of } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class NgxCaptureService {\r\n  getImage(screen: HTMLElement, fullCapture?: boolean, cropDimensions?: any): Observable<string> {\r\n    let options = {\r\n      logging: false,\r\n    };\r\n\r\n    if (!fullCapture && cropDimensions.width > 10 && cropDimensions.height > 10) {\r\n      options = { ...options, ...cropDimensions };\r\n    } else if (!fullCapture) {\r\n      return of(null);\r\n    }\r\n\r\n    return from(\r\n      html2canvas(screen, options)\r\n        .then(\r\n          (canv) => {\r\n            const img = canv.toDataURL('image/png');\r\n            return img;\r\n          },\r\n          (err) => {\r\n            throw new Error(err);\r\n          }\r\n        )\r\n        .catch((res) => {\r\n          throw new Error(res);\r\n        })\r\n    );\r\n  }\r\n\r\n  // TODO\r\n  private downloadImage(img: string) {\r\n    // this.canvas.nativeElement.src = img;\r\n    // this.downloadLink.nativeElement.href = img;\r\n    // this.downloadLink.nativeElement.download = 'test.png';\r\n    // this.downloadLink.nativeElement.click();\r\n  }\r\n}\r\n","import { Component, ElementRef, EventEmitter, Input, OnInit, Output, ViewChild } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { take, tap } from 'rxjs/operators';\r\nimport { NgxCaptureService } from './ngx-capture.service';\r\n\r\ntype Point = {\r\n  x: number;\r\n  y: number;\r\n};\r\n@Component({\r\n  selector: 'ngx-capture',\r\n  template: `\r\n    <ng-content></ng-content>\r\n    <div class=\"overlay\" #over>\r\n      <div class=\"rectangle\" #rect></div>\r\n    </div>\r\n  `,\r\n  styleUrls: ['./ngx-capture.component.scss'],\r\n})\r\nexport class NgxCaptureComponent implements OnInit {\r\n  @ViewChild('rect', { static: true }) rectangle: ElementRef;\r\n  @ViewChild('over', { static: true }) overlay: ElementRef;\r\n\r\n  @Input() target: any;\r\n\r\n  @Output() resultImage = new EventEmitter<string>();\r\n\r\n  rect: HTMLElement;\r\n  captureZone: HTMLElement;\r\n\r\n  isDrawing = false;\r\n\r\n  mouseStart: Point = { x: 0, y: 0 };\r\n\r\n  cropDimensions = {\r\n    x: 0,\r\n    y: 0,\r\n    width: 0,\r\n    height: 0,\r\n  };\r\n\r\n  destroy$ = new Subject<void>();\r\n\r\n  constructor(private captureService: NgxCaptureService) {}\r\n\r\n  ngOnInit() {\r\n    setTimeout(() => {\r\n      this.rect = this.rectangle.nativeElement;\r\n      this.captureZone = this.overlay.nativeElement;\r\n\r\n      if (!this.captureZone) {\r\n        console.warn('\"captureZone\" is not set');\r\n        return;\r\n      }\r\n\r\n      this.captureZone.onmousedown = (e) => this.startCapture(e);\r\n      this.captureZone.onmousemove = (e) => this.drawRect(e);\r\n      this.captureZone.onmouseup = () => this.endCapture();\r\n    }, 2000);\r\n  }\r\n\r\n  private startCapture(e: any) {\r\n    const mouse = this.setMousePosition(e, true);\r\n\r\n    this.isDrawing = true;\r\n\r\n    this.cropDimensions = {\r\n      x: mouse.x,\r\n      y: mouse.y,\r\n      width: 0,\r\n      height: 0,\r\n    };\r\n\r\n    this.captureZone.style.cursor = 'crosshair';\r\n  }\r\n\r\n  private drawRect(e: any) {\r\n    if (this.isDrawing) {\r\n      const mouse = this.setMousePosition(e, false);\r\n\r\n      this.cropDimensions = {\r\n        x: mouse.x - this.mouseStart.x < 0 ? mouse.x : this.mouseStart.x,\r\n        y: mouse.y - this.mouseStart.y < 0 ? mouse.y : this.mouseStart.y,\r\n        width: Math.abs(mouse.x - this.mouseStart.x),\r\n        height: Math.abs(mouse.y - this.mouseStart.y),\r\n      };\r\n      this.setRectangle();\r\n    }\r\n  }\r\n\r\n  private setMousePosition(e: any, isStart = false) {\r\n    const ev = e || window.event; // Moz || IE\r\n    const mouse: Point = { x: 0, y: 0 };\r\n\r\n    if (ev.pageX) {\r\n      // Moz\r\n      mouse.x = ev.clientX;\r\n      mouse.y = ev.clientY;\r\n    } else if (ev.clientX) {\r\n      // IE\r\n      mouse.x = ev.clientX + document.body.scrollLeft;\r\n      mouse.y = ev.clientY + document.body.scrollTop;\r\n    }\r\n\r\n    if (isStart) {\r\n      this.mouseStart.x = mouse.x;\r\n      this.mouseStart.y = mouse.y;\r\n    }\r\n\r\n    return mouse;\r\n  }\r\n\r\n  private endCapture() {\r\n    this.captureZone.style.cursor = 'default';\r\n    this.isDrawing = false;\r\n\r\n    this.captureService\r\n      .getImage(this.target, false, {\r\n        ...this.cropDimensions,\r\n        x: this.cropDimensions.x + window.scrollX,\r\n        y: this.cropDimensions.y + window.scrollY,\r\n      })\r\n      .pipe(\r\n        take(1),\r\n        tap((img) => {\r\n          this.resultImage.emit(img);\r\n        })\r\n      )\r\n      .subscribe();\r\n\r\n    this.cropDimensions = {\r\n      x: 0,\r\n      y: 0,\r\n      width: 0,\r\n      height: 0,\r\n    };\r\n    this.setRectangle();\r\n  }\r\n\r\n  private setRectangle() {\r\n    this.rect.style.left = this.cropDimensions.x + 'px';\r\n    this.rect.style.top = this.cropDimensions.y + 'px';\r\n    this.rect.style.width = this.cropDimensions.width + 'px';\r\n    this.rect.style.height = this.cropDimensions.height + 'px';\r\n  }\r\n}\r\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { NgxCaptureComponent } from './ngx-capture.component';\r\n\r\n@NgModule({\r\n  declarations: [NgxCaptureComponent],\r\n  imports: [\r\n  ],\r\n  exports: [NgxCaptureComponent],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class NgxCaptureModule { }\r\n","/*\r\n * Public API Surface of ngx-capture\r\n */\r\n\r\nexport * from './lib/ngx-capture.service';\r\nexport * from './lib/ngx-capture.component';\r\nexport * from './lib/ngx-capture.module';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"]}