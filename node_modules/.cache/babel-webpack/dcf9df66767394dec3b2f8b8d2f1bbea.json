{"ast":null,"code":"import { ApiService } from '../../services/api.service';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport { StorageService } from '../../services/storage.service';\nimport { Tab3Service } from '../../../tab3/tab3.service';\nimport { UserService } from '../../services/user.service';\nimport { Router } from '@angular/router';\nimport { InitService } from '../../services/init.service';\nimport { HttpClient } from '@angular/common/http';\nimport { BulletBankService } from \"../../services/bullet-bank.service\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"../../services/storage.service\";\nimport * as i3 from \"../../../tab3/tab3.service\";\nimport * as i4 from \"@angular/common/http\";\nimport * as i5 from \"../../services/init.service\";\nimport * as i6 from \"../../services/bullet-bank.service\";\nimport * as i7 from \"../../services/user.service\";\nimport * as i8 from \"@angular/router\";\nexport let WizardService = /*#__PURE__*/(() => {\n  class WizardService {\n    constructor(apiService, storageService, tab3Service, http, initService, bankOfBullets, userService, router) {\n      this.apiService = apiService;\n      this.storageService = storageService;\n      this.tab3Service = tab3Service;\n      this.http = http;\n      this.initService = initService;\n      this.bankOfBullets = bankOfBullets;\n      this.userService = userService;\n      this.router = router;\n      this.notifyUserWasRegisterd = new BehaviorSubject(false);\n      this.notifyInventoryWasSet = new BehaviorSubject(false);\n      this.notifyTargetAssigned = new BehaviorSubject(false);\n      this.notifyWizardSummaryStart = new BehaviorSubject(false);\n      this.notifyWeaponWasSet = new BehaviorSubject(false);\n      this.notifyScopeWasSet = new BehaviorSubject(false);\n      this.selectTargetFromWizardOpened = new BehaviorSubject(false);\n      this.afterSubscriptionDone = new BehaviorSubject({});\n      this.isFromListScreen = false;\n      this.moreInfoForm = {};\n      this.isLoading = new Subject();\n      this.BACKOFFICE_URL = 'https://adlbackoffice20200309103113.azurewebsites.net/';\n    }\n    registerUser(registerUser) {\n      let myTarget = this.storageService.getItem('personalTarget');\n      if (myTarget) {\n        myTarget = {\n          id: myTarget.id,\n          name: myTarget.name\n        };\n      } else {\n        myTarget = {\n          id: '',\n          name: ''\n        };\n      }\n      const toSend = {\n        age: '0',\n        email: '',\n        first_name: '',\n        last_name: '',\n        password: '',\n        gender: '',\n        state: '',\n        conutry: '',\n        img_path: '',\n        sights: [],\n        weapons: [],\n        target: {\n          id: 'string',\n          name: 'string'\n        }\n      };\n      if (this.moreInfoForm.age) {\n        toSend.age = this.moreInfoForm.age.toString();\n      }\n      toSend.email = this.registerForm.value.email;\n      toSend.first_name = this.registerForm.value.first_name;\n      toSend.last_name = this.registerForm.value.last_name;\n      toSend.password = this.registerForm.value.password;\n      toSend.state = this.registerForm.value.cityName;\n      if (this.moreInfoForm.gendre) {\n        toSend.gender = this.moreInfoForm.gendre;\n      }\n      if (this.moreInfoForm.state) {\n        toSend.state = this.moreInfoForm.state;\n      }\n      if (this.moreInfoForm.conutry) {\n        toSend.conutry = this.moreInfoForm.conutry;\n      }\n      if (this.moreInfoForm.profilePicture) {\n        toSend.img_path = this.moreInfoForm.profilePicture;\n      }\n      if (this.moreInfoForm.sights) {\n        toSend.sights = this.moreInfoForm.sights;\n      }\n      if (this.moreInfoForm.weapons) {\n        toSend.weapons = this.moreInfoForm.weapons;\n      }\n      if (this.moreInfoForm.target) {\n        toSend.target = this.moreInfoForm.target;\n      }\n      toSend.target = myTarget;\n      console.log('In registerUser Before HTTP For Register' + new Date());\n      // this.initService.isLoading.next(true);\n      this.isLoading.next(true);\n      this.http.post(this.BACKOFFICE_URL + 'Login/register', toSend).subscribe(returnedValue => {\n        console.log('In registerUser AFTER HTTP For Register BEFORE SignIn' + new Date());\n        this.bankOfBullets.setNumberOfBullets(20);\n        this.login({\n          username: toSend.email,\n          password: toSend.password\n        }).subscribe(data => {\n          if (data) {\n            this.userService.setUser(data);\n            this.getDashboardData(this.userService.getUserId());\n            this.storageService.setItem('isLoggedIn', true);\n            this.storageService.setItem('profileData', data);\n            this.notifyUserWasRegisterd.next(true);\n            this.isLoading.next(false);\n          }\n        });\n      });\n    }\n    login(loginDetails) {\n      return this.http.post(this.BACKOFFICE_URL + 'Login/authenticate', loginDetails);\n    }\n    getDashboardData(userId) {\n      return this.http.get(this.BACKOFFICE_URL + 'DeviceData/GetDashboard?userId=' + userId);\n    }\n  }\n  WizardService.ɵfac = function WizardService_Factory(t) {\n    return new (t || WizardService)(i0.ɵɵinject(i1.ApiService), i0.ɵɵinject(i2.StorageService), i0.ɵɵinject(i3.Tab3Service), i0.ɵɵinject(i4.HttpClient), i0.ɵɵinject(i5.InitService), i0.ɵɵinject(i6.BulletBankService), i0.ɵɵinject(i7.UserService), i0.ɵɵinject(i8.Router));\n  };\n  WizardService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: WizardService,\n    factory: WizardService.ɵfac,\n    providedIn: 'root'\n  });\n  return WizardService;\n})();","map":null,"metadata":{},"sourceType":"module"}